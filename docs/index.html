<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
  <head>
    <meta charset="UTF-8" />
    <title>JSON Query - a lightweight, flexible, and expandable JSON query language</title>
    <link rel="stylesheet" href="style.css" />
    <meta name="description" content="Repair broken JSON documents" />
    <meta name="keywords" content="json, repair, simple, json-simple-repair, fix, invalid" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href="frog-756900-100.png">
  </head>
  <body>
    <div class="app">
      <div class="header">
        <div class="header-contents">
          <!-- source: https://pixy.org/756900/ -->
          <img
            src="frog-756900-100.png"
            srcset="frog-756900-200.png 2x"
            alt="JSON Query logo"
            class="header-icon"
            width="100"
            height="98"
          />
          <div class="header-text">
            <h1>JSON Query</h1>
            <p>A lightweight, flexible, and expandable JSON query language.</p>
            <p>
              Documentation:
              <a href="https://github.com/josdejong/jsonquery">
                https://github.com/josdejong/jsonquery
              </a>
            </p>
          </div>
        </div>
      </div>
      <div class="examples">
        <div class="examples-inner">
          <button class="example" id="example1">example 1</button>
          <button class="example" id="example2">example 2</button>
          <button class="example" id="example3">example 3</button>
          <button class="example" id="example4">example 4</button>
        </div>
      </div>
      <div class="playground">
        <div class="column">
          <label for="input-text">Input</label>
          <textarea id="input-text" autocomplete="off" autocapitalize="off" spellcheck="false">{
  "friends": [
    {"name": "Chris", "age": 23, "city": "New York"},
    {"name": "Emily", "age": 19, "city": "Atlanta"},
    {"name": "Joe", "age": 32, "city": "New York"},
    {"name": "Kevin", "age": 19, "city": "Atlanta"},
    {"name": "Michelle", "age": 27, "city": "Los Angeles"},
    {"name": "Robert", "age": 45, "city": "Manhattan"},
    {"name": "Sarah", "age": 31, "city": "New York"}
  ]
}</textarea
          >
        </div>
        <div class="column">
          <label for="query-text">Query</label>
          <textarea id="query-text" autocomplete="off" autocapitalize="off" spellcheck="false">[
  ["friends"],
  ["filter", ["city", "==", ["string", "New York"]]],
  ["sort", "age"],
  ["pick", "name", "age"]
]</textarea
          >
        </div>
        <div class="column">
          <label for="output-text">Output</label>
          <textarea id="output-text" readonly>loading...</textarea>
        </div>
      </div>
    </div>

    <script type="module">
      import { jsonquery } from 'https://cdn.jsdelivr.net/npm/@josdejong/jsonquery/lib/jsonquery.js'

      const inputText = document.getElementById('input-text')
      const queryText = document.getElementById('query-text')
      const outputText = document.getElementById('output-text')

      const input1 = inputText.value
      const query1 = queryText.value

      const input2 = inputText.value
      const query2 = `[
  ["friends"],
  ["filter", [
    ["city", "==", ["string", "New York"]],
    "and",
    ["age", ">", 30]
  ]],
  ["sort", "age"],
  ["pick", "name", "age"]
]`

      const input3 = inputText.value
      const query3 = `[
  ["friends"],
  {
    "names": ["map", "name"],
    "count": ["size"],
    "averageAge": [
      ["map", "age"],
      ["average"]
    ]
  }
]`

      const input4 = `[
  { "name": "bread", "price": 2.5, "quantity": 2 },
  { "name": "milk", "price": 1.2, "quantity": 3 }
]`
      const query4 = `[
  ["map", ["price", "*", "quantity"]],
  ["sum"]
]`

      function go() {
        try {
          const input = JSON.parse(inputText.value)
          const query = JSON.parse(queryText.value)
          const output = jsonquery(input, query)
          outputText.value = JSON.stringify(output, null, 2)
          outputText.classList.remove('error')
        } catch (err) {
          outputText.value = err.message
          outputText.classList.add('error')
        }
      }

      function load(input, query) {
        inputText.value = input
        queryText.value = query
        go()
      }

      inputText.addEventListener('input', go)
      queryText.addEventListener('input', go)
      document.getElementById('example1').onclick = () => load(input1, query1)
      document.getElementById('example2').onclick = () => load(input2, query2)
      document.getElementById('example3').onclick = () => load(input3, query3)
      document.getElementById('example4').onclick = () => load(input4, query4)

      go()
    </script>
  </body>
</html>
